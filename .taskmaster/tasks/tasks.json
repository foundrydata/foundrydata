{
  "project": "FoundryData",
  "version": "0.1.0-mvp",
  "approach": "Hybrid (Task Master structure + granular subtasks)",
  "feature-simplification": {
    "tasks": [
      {
        "id": "8000",
        "title": "AGENT — Operating mode for Claude Code",
        "description": "Execution discipline and guardrails for building from SPEC via anchors only.",
        "priority": "medium",
        "estimatedHours": 0,
        "dependencies": [],
        "status": "done",
        "complexityScore": 1,
        "details": "[Agent Instructions — Minimal + Guardrails]\n[Goal]\n\n* Execute implementation tasks strictly per SPEC; SPEC is the single source of truth for semantics. Do not enlarge feature scope.\n  [Retrieval]\n* REFONLY via SPEC anchors. Do not paste SPEC text verbatim into tasks.\n* Runtime mapping: spec://§<n>#<slug> → docs/feature-simplification/feature-support-simplification.md#s<n>-<slug>.\n* Keep working context small: load only anchors required by the current task.\n  [Execution order]\n\n1. Read §0 metadata (task 9000).\n2. Build the reference index from 9100..9124 (anchors only).\n3. Implement tasks 1..24 in numeric order, respecting declared dependencies.\n4. Run tests and bench; validate Definition of Done.\n5. **Staging**: For `propertyNames` rewrite, implement **enum-only** in P0; **pattern-form** deferred to **P2 (#23)**.\n   [Environment]\n\n* Node >= 18; TypeScript; pnpm; monorepo layout under packages/core/* (per SPEC §22).\n  [Commands]\n* pnpm i\n* pnpm -w build\n* pnpm -w test\n* pnpm -w bench\n  [Diagnostics — phase separation]\n* REGEX_COMPLEXITY_CAPPED appears only from Normalize/Compose, with details.context ∈ {'coverage','rewrite'}.\n* COMPLEXITY_CAP_PATTERNS appears only from the Generator (pattern-witness search).\n* Compose-time caps (COMPLEXITY_CAP_ONEOF/ANYOF/ENUM/CONTAINS/SCHEMA_SIZE) are planning-only; never emit them from the Generator.\n  [Branch bookkeeping (per SPEC §8)]\n* Score-only path: record diag.scoreDetails.tiebreakRand EVEN WHEN |T|=1.\n* Score-only budget: diag.budget = { skipped:true, tried:0, limit = trials.perBranch × K_effective, reason ∈ {'skipTrialsFlag','largeOneOf','largeAnyOf','complexityCap'} }, where K_effective = min(maxBranchesToTry, branches.length AFTER Compose-time caps).\n* oneOf exclusivity step-4: if RNG is used (only when b* no longer passes), record diag.scoreDetails.exclusivityRand.\n  [AP:false coverage guardrails]\n* Under additionalProperties:false, NEVER expand coverage from propertyNames.enum unless PNAMES_REWRITE_APPLIED is present.\n* Fail-fast (AP_FALSE_UNSAFE_PATTERN) ONLY when presence pressure exists at the object (effectiveMinProperties > 0 OR effectiveRequiredKeys ≠ ∅ OR an active dependentRequired antecedent). Otherwise, proceed via conservative exclusion (no fail-fast).\n* Raw propertyNames.pattern NEVER triggers AP_FALSE_UNSAFE_PATTERN; it is gating-only unless PNAMES_REWRITE_APPLIED.\n  [Unevaluated guard]\n* For unevaluatedProperties:false, only emit property names guaranteed “evaluated” by an applicator at the SAME instance location, either present directly OR reachable through an APPLIED subschema at that location (e.g., allOf conjuncts, the selected anyOf/oneOf branch, the active then/else of if, or a $ref target). dependentSchemas does not evaluate by itself; only applicators inside its active subschema do.\n  [AJV Config Gate (per SPEC §§12–13)]\n* Two Ajv instances: Source (original schema) and Planning/Generation (canonical view). Both MUST set unicodeRegExp:true.\n* Ajv class MUST match the source schema dialect (Ajv / Ajv2019 / Ajv2020 / ajv-draft-04). Do not mix 2020-12 with earlier drafts in the same instance.\n* validateFormats MUST be identical on both instances (both false, or both true with ajv-formats). Mismatches ⇒ AJV_FLAGS_MISMATCH.\n* allowUnionTypes policy consistent with responsibilities (enabled on Planning/Generation when compiling union-typed canonical views).\n* If discriminator is claimed, set discriminator:true on BOTH instances; otherwise disabled on both.\n* multipleOfPrecision MUST equal PlanOptions.rational.decimalPrecision on BOTH instances whenever rational.fallback ∈ {'decimal','float'}; mismatches ⇒ AJV_FLAGS_MISMATCH.\n  [Definition of Done]\n* Files delivered per subtasks; tests green with ≥80% coverage on touched files.\n* Diagnostics conform to SPEC §19.1 mini-schemas.\n* Final AJV validation runs against the original schema (not the canonical/effective view).\n* Bench gates (SPEC §15) satisfied: p95LatencyMs ≤ 120 ms and memoryPeakMB ≤ 512 MB on required profiles.\n  [Diagnostics verbosity]\n* Provide a verbosity toggle: “CI verbose” (full diagnostics/metrics) vs “runtime normal” (reduced payloads) **without** changing §19.1 shapes.\n  [Self-audit before emit]\n* All SPEC task records 9100..9124: details = REFONLY; no SPEC text duplicated elsewhere.\n* Validate REFONLY: outer JSON parses; after stripping `REFONLY::`, inner JSON parses; reject if invalid.\n* Branch selection score-only invariants satisfied (tiebreakRand, budget.skipped/tried/limit/reason as above).\n* oneOf exclusivity: if RNG used at step-4, exclusivityRand recorded.\n* No REGEX_COMPLEXITY_CAPPED from Generator; no COMPLEXITY_CAP_PATTERNS from Normalize/Compose/Rewrite.\n* AP:false: no coverage expansion from propertyNames without PNAMES_REWRITE_APPLIED.\n* Repair rename guard under AP:false: use ctx.isNameInMustCover(canonPath, name) from Compose’s CoverageIndex; if absent, do NOT rename and emit MUSTCOVER_INDEX_MISSING{guard:true}.\n* External $ref handling: Strict ⇒ error EXTERNAL_REF_UNRESOLVED; Lax ⇒ warn + attempt; if Source Ajv compile fails solely due to unresolved externals, skip final validation with details.skippedValidation:true and set diag.metrics.validationsPerRow = 0.\n* Unique subtask ids are enforced (e.g., taskId*1000 + ordinal).",
        "testStrategy": "N/A — process guardrails only.",
        "subtasks": [
          {
            "id": 8000001,
            "title": "Author AGENT runbook (execution order, guardrails, DoD)",
            "status": "done",
            "estimatedHours": 0,
            "file": "docs/AGENT_RUNBOOK.md",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9000",
        "title": "SPEC — Canonical Source (header & metadata)",
        "description": "Reference-only: section §0.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§0\",\"anchors\":[\"spec://§0#status\",\"spec://§0#audience\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9000001,
            "title": "Index anchor — status",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§0#status",
            "parentId": "undefined"
          },
          {
            "id": 9000002,
            "title": "Index anchor — audience",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§0#audience",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9050",
        "title": "SPEC — Maintenance / Evolution",
        "description": "Reference-only: section §24.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§24\",\"anchors\":[\"spec://§24#normative\",\"spec://§24#alignment\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9050001,
            "title": "Index anchor — normative references",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§24#normative",
            "parentId": "undefined"
          },
          {
            "id": 9050002,
            "title": "Index anchor — reference alignment",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§24#alignment",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9100",
        "title": "Terminology (preamble — quick ref)",
        "description": "Reference-only: section §0.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§0\",\"anchors\":[\"spec://§0#terminology\",\"spec://§0#definitions\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9100001,
            "title": "Index anchor — terminology",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§0#terminology",
            "parentId": "undefined"
          },
          {
            "id": 9100002,
            "title": "Index anchor — definitions",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§0#definitions",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9101",
        "title": "§1 Goal",
        "description": "Reference-only: section §1.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§1\",\"anchors\":[\"spec://§1#goal\",\"spec://§1#acceptance\",\"spec://§1#bench-sli-gate\",\"spec://§1#config-gate\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9101001,
            "title": "Index anchor — goal",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§1#goal",
            "parentId": "undefined"
          },
          {
            "id": 9101002,
            "title": "Index anchor — acceptance",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§1#acceptance",
            "parentId": "undefined"
          },
          {
            "id": 9101003,
            "title": "Index anchor — bench SLI gate",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§1#bench-sli-gate",
            "parentId": "undefined"
          },
          {
            "id": 9101004,
            "title": "Index anchor — config gate",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§1#config-gate",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9102",
        "title": "§2 Scope",
        "description": "Reference-only: section §2.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§2\",\"anchors\":[\"spec://§2#in-scope\",\"spec://§2#non-goals\",\"spec://§2#environment\",\"spec://§2#modes\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9102001,
            "title": "Index anchor — in-scope",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§2#in-scope",
            "parentId": "undefined"
          },
          {
            "id": 9102002,
            "title": "Index anchor — non-goals",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§2#non-goals",
            "parentId": "undefined"
          },
          {
            "id": 9102003,
            "title": "Index anchor — environment & drafts",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§2#environment",
            "parentId": "undefined"
          },
          {
            "id": 9102004,
            "title": "Index anchor — modes",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§2#modes",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9103",
        "title": "§3 Principles & Invariants",
        "description": "Reference-only: section §3.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§3\",\"anchors\":[\"spec://§3#core-principles\",\"spec://§3#invariants\",\"spec://§3#apfalse-unsafe-pattern-policy\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9103001,
            "title": "Index anchor — core principles",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§3#core-principles",
            "parentId": "undefined"
          },
          {
            "id": 9103002,
            "title": "Index anchor — invariants",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§3#invariants",
            "parentId": "undefined"
          },
          {
            "id": 9103003,
            "title": "Index anchor — AP:false unsafe-pattern policy",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§3#apfalse-unsafe-pattern-policy",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9104",
        "title": "§4 Operational guidance",
        "description": "Reference-only: section §4.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§4\",\"anchors\":[\"spec://§4#pipeline\",\"spec://§4#observability\",\"spec://§4#fail-early\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9104001,
            "title": "Index anchor — pipeline",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§4#pipeline",
            "parentId": "undefined"
          },
          {
            "id": 9104002,
            "title": "Index anchor — observability",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§4#observability",
            "parentId": "undefined"
          },
          {
            "id": 9104003,
            "title": "Index anchor — fail-early",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§4#fail-early",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9105",
        "title": "§5 Configuration Overview",
        "description": "Reference-only: section §5.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§5\",\"anchors\":[\"spec://§5#options-table\",\"spec://§5#pattern-witness\",\"spec://§5#precedence\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9105001,
            "title": "Index anchor — options table",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§5#options-table",
            "parentId": "undefined"
          },
          {
            "id": 9105002,
            "title": "Index anchor — pattern witness options",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§5#pattern-witness",
            "parentId": "undefined"
          },
          {
            "id": 9105003,
            "title": "Index anchor — precedence & compatibility",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§5#precedence",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9106",
        "title": "§6 High-Level Architecture",
        "description": "Reference-only: section §6.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§6\",\"anchors\":[\"spec://§6#phases\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9106001,
            "title": "Index anchor — phases",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§6#phases",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9107",
        "title": "§7 Schema Normalizer (Canonicalization)",
        "description": "Reference-only: section §7.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§7\",\"anchors\":[\"spec://§7#object-keywords-pnames-rewrite\",\"spec://§7#conditionals-rewrite\",\"spec://§7#pass-order\",\"spec://§7#note-codes\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9107001,
            "title": "Index anchor — propertyNames rewrite",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§7#object-keywords-pnames-rewrite",
            "parentId": "undefined"
          },
          {
            "id": 9107002,
            "title": "Index anchor — conditionals rewrite",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§7#conditionals-rewrite",
            "parentId": "undefined"
          },
          {
            "id": 9107003,
            "title": "Index anchor — pass order",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§7#pass-order",
            "parentId": "undefined"
          },
          {
            "id": 9107004,
            "title": "Index anchor — normalizer note codes",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§7#note-codes",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9108",
        "title": "§8 Composition Engine",
        "description": "Reference-only: section §8.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§8\",\"anchors\":[\"spec://§8#coverage-index-export\",\"spec://§8#coverage-index-enumerate\",\"spec://§8#branch-selection\",\"spec://§8#oneof-exclusivity\",\"spec://§8#anchored-safe-definition\",\"spec://§8#regex-complexity-cap\",\"spec://§8#apfalse-must-cover\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9108001,
            "title": "Index anchor — Coverage Index export",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#coverage-index-export",
            "parentId": "undefined"
          },
          {
            "id": 9108002,
            "title": "Index anchor — enumerate order",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#coverage-index-enumerate",
            "parentId": "undefined"
          },
          {
            "id": 9108003,
            "title": "Index anchor — branch selection",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#branch-selection",
            "parentId": "undefined"
          },
          {
            "id": 9108004,
            "title": "Index anchor — oneOf exclusivity",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#oneof-exclusivity",
            "parentId": "undefined"
          },
          {
            "id": 9108005,
            "title": "Index anchor — anchored-safe definition",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#anchored-safe-definition",
            "parentId": "undefined"
          },
          {
            "id": 9108006,
            "title": "Index anchor — regex complexity cap",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#regex-complexity-cap",
            "parentId": "undefined"
          },
          {
            "id": 9108007,
            "title": "Index anchor — AP:false must-cover",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§8#apfalse-must-cover",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9109",
        "title": "§9 Generator",
        "description": "Reference-only: section §9.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§9\",\"anchors\":[\"spec://§9#if-aware-lite\",\"spec://§9#pattern-witness-selection\",\"spec://§9#arrays-contains\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9109001,
            "title": "Index anchor — if-aware-lite",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§9#if-aware-lite",
            "parentId": "undefined"
          },
          {
            "id": 9109002,
            "title": "Index anchor — pattern witness selection",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§9#pattern-witness-selection",
            "parentId": "undefined"
          },
          {
            "id": 9109003,
            "title": "Index anchor — arrays contains (bag)",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§9#arrays-contains",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9110",
        "title": "§10 Repair Engine (AJV-Driven)",
        "description": "Reference-only: section §10.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§10\",\"anchors\":[\"spec://§10#mapping\",\"spec://§10#propertynames-rename-guard\",\"spec://§10#structural-hashing\",\"spec://§10#epsilon-logging\",\"spec://§10#property-order\",\"spec://§10#mustcover-index-missing\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9110001,
            "title": "Index anchor — mapping",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#mapping",
            "parentId": "undefined"
          },
          {
            "id": 9110002,
            "title": "Index anchor — propertyNames rename guard",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#propertynames-rename-guard",
            "parentId": "undefined"
          },
          {
            "id": 9110003,
            "title": "Index anchor — structural hashing",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#structural-hashing",
            "parentId": "undefined"
          },
          {
            "id": 9110004,
            "title": "Index anchor — epsilon logging",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#epsilon-logging",
            "parentId": "undefined"
          },
          {
            "id": 9110005,
            "title": "Index anchor — property order",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#property-order",
            "parentId": "undefined"
          },
          {
            "id": 9110006,
            "title": "Index anchor — MUSTCOVER index missing",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§10#mustcover-index-missing",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9111",
        "title": "§11 Modes",
        "description": "Reference-only: section §11.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§11\",\"anchors\":[\"spec://§11#external-ref-probe\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9111001,
            "title": "Index anchor — external ref probe (Lax eligibility)",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§11#external-ref-probe",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9112",
        "title": "§12 Draft Handling",
        "description": "Reference-only: section §12.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§12\",\"anchors\":[\"spec://§12#ajv-class-selection\",\"spec://§12#refs-and-dynamic\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9112001,
            "title": "Index anchor — Ajv class selection",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§12#ajv-class-selection",
            "parentId": "undefined"
          },
          {
            "id": 9112002,
            "title": "Index anchor — refs and dynamic refs",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§12#refs-and-dynamic",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9113",
        "title": "§13 AJV Configuration",
        "description": "Reference-only: section §13.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§13\",\"anchors\":[\"spec://§13#startup-config-check\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9113001,
            "title": "Index anchor — startup config check",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§13#startup-config-check",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9114",
        "title": "§14 Cache Strategy",
        "description": "Reference-only: section §14.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§14\",\"anchors\":[\"spec://§14#stable-hash\",\"spec://§14#planoptionssubkey\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9114001,
            "title": "Index anchor — stable hash",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§14#stable-hash",
            "parentId": "undefined"
          },
          {
            "id": 9114002,
            "title": "Index anchor — PlanOptionsSubKey",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§14#planoptionssubkey",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9115",
        "title": "§15 Performance, Determinism & Metrics",
        "description": "Reference-only: section §15.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§15\",\"anchors\":[\"spec://§15#rng\",\"spec://§15#metrics\",\"spec://§15#slo-sli\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9115001,
            "title": "Index anchor — RNG",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§15#rng",
            "parentId": "undefined"
          },
          {
            "id": 9115002,
            "title": "Index anchor — metrics fields",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§15#metrics",
            "parentId": "undefined"
          },
          {
            "id": 9115003,
            "title": "Index anchor — SLO/SLI gates",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§15#slo-sli",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9116",
        "title": "§16 Implementation Plan",
        "description": "Reference-only: section §16.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§16\",\"anchors\":[\"spec://§16#phase-p0\",\"spec://§16#acceptance-p0\",\"spec://§16#phase-p1\",\"spec://§16#phase-p2\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9116001,
            "title": "Index anchor — Phase P0",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§16#phase-p0",
            "parentId": "undefined"
          },
          {
            "id": 9116002,
            "title": "Index anchor — Acceptance P0",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§16#acceptance-p0",
            "parentId": "undefined"
          },
          {
            "id": 9116003,
            "title": "Index anchor — Phase P1",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§16#phase-p1",
            "parentId": "undefined"
          },
          {
            "id": 9116004,
            "title": "Index anchor — Phase P2",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§16#phase-p2",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9117",
        "title": "§17 Documentation Additions",
        "description": "Reference-only: section §17.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§17\",\"anchors\":[\"spec://§17#invariants-doc\",\"spec://§17#known-limits\",\"spec://§17#features-matrix\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9117001,
            "title": "Index anchor — Invariants doc",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§17#invariants-doc",
            "parentId": "undefined"
          },
          {
            "id": 9117002,
            "title": "Index anchor — Known Limits",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§17#known-limits",
            "parentId": "undefined"
          },
          {
            "id": 9117003,
            "title": "Index anchor — Features Matrix",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§17#features-matrix",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9118",
        "title": "§18 Features Matrix",
        "description": "Reference-only: section §18.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§18\",\"anchors\":[\"spec://§18#matrix\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9118001,
            "title": "Index anchor — Features Matrix",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§18#matrix",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9119",
        "title": "§19 Diagnostics (codes)",
        "description": "Reference-only: section §19.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§19\",\"anchors\":[\"spec://§19#envelope\",\"spec://§19#payloads\",\"spec://§19#phase-separation\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9119001,
            "title": "Index anchor — diagnostics envelope",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§19#envelope",
            "parentId": "undefined"
          },
          {
            "id": 9119002,
            "title": "Index anchor — details payloads",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§19#payloads",
            "parentId": "undefined"
          },
          {
            "id": 9119003,
            "title": "Index anchor — phase separation",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§19#phase-separation",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9120",
        "title": "§20 Testing Strategy",
        "description": "Reference-only: section §20.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§20\",\"anchors\":[\"spec://§20#unit\",\"spec://§20#integration\",\"spec://§20#bench-ci\",\"spec://§20#metamorphic\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9120001,
            "title": "Index anchor — unit tests",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§20#unit",
            "parentId": "undefined"
          },
          {
            "id": 9120002,
            "title": "Index anchor — integration tests",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§20#integration",
            "parentId": "undefined"
          },
          {
            "id": 9120003,
            "title": "Index anchor — bench/CI",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§20#bench-ci",
            "parentId": "undefined"
          },
          {
            "id": 9120004,
            "title": "Index anchor — metamorphic/equivalence",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§20#metamorphic",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9121",
        "title": "§21 Risks & Mitigations",
        "description": "Reference-only: section §21.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§21\",\"anchors\":[\"spec://§21#mitigations\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9121001,
            "title": "Index anchor — mitigations",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§21#mitigations",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9122",
        "title": "§22 Deliverables (Code)",
        "description": "Reference-only: section §22.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§22\",\"anchors\":[\"spec://§22#packages-core\",\"spec://§22#scripts\",\"spec://§22#docs\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9122001,
            "title": "Index anchor — packages/core list",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§22#packages-core",
            "parentId": "undefined"
          },
          {
            "id": 9122002,
            "title": "Index anchor — scripts",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§22#scripts",
            "parentId": "undefined"
          },
          {
            "id": 9122003,
            "title": "Index anchor — docs deliverables",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§22#docs",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9123",
        "title": "§23 Appendix — Minimal Interfaces",
        "description": "Reference-only: section §23.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§23\",\"anchors\":[\"spec://§23#plan-options\",\"spec://§23#compose-interfaces\",\"spec://§23#repair-interfaces\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9123001,
            "title": "Index anchor — PlanOptions",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§23#plan-options",
            "parentId": "undefined"
          },
          {
            "id": 9123002,
            "title": "Index anchor — compose interfaces",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§23#compose-interfaces",
            "parentId": "undefined"
          },
          {
            "id": 9123003,
            "title": "Index anchor — repair interfaces",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§23#repair-interfaces",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "9124",
        "title": "§24 Norms & References",
        "description": "Reference-only: section §24.",
        "priority": "low",
        "estimatedHours": 0,
        "dependencies": [
          "9000"
        ],
        "status": "done",
        "complexityScore": 1,
        "details": "REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§24\",\"anchors\":[\"spec://§24#normative\",\"spec://§24#informative\",\"spec://§24#alignment\"],\"notes\":\"no-embed; fetch-on-demand\"}",
        "testStrategy": "None.",
        "subtasks": [
          {
            "id": 9124001,
            "title": "Index anchor — normative refs",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§24#normative",
            "parentId": "undefined"
          },
          {
            "id": 9124002,
            "title": "Index anchor — informative refs",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§24#informative",
            "parentId": "undefined"
          },
          {
            "id": 9124003,
            "title": "Index anchor — alignment table",
            "status": "done",
            "estimatedHours": 0,
            "file": "spec://§24#alignment",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "1",
        "title": "Scaffolding & Monorepo",
        "description": "Initialize monorepo, packages, basic build/test/bench harness, and docs skeleton.",
        "priority": "high",
        "estimatedHours": 16,
        "dependencies": [
          "8000",
          "9000",
          "9106",
          "9122"
        ],
        "status": "done",
        "complexityScore": 3,
        "details": "[Context] SPEC anchors (§6 phases; §22 deliverables).\n- §6: spec://§6#phases\n- §22: spec://§22#packages-core, spec://§22#scripts, spec://§22#docs\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§6\",\"anchors\":[\"spec://§6#phases\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§22\",\"anchors\":[\"spec://§22#packages-core\",\"spec://§22#scripts\",\"spec://§22#docs\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Monorepo (pnpm, TS), packages under packages/core per §22.\n- Wire scripts/bench.ts and basic test runner.\n- Do not implement semantics here; only scaffolding.\n[Deliverables]\n- Create files per §22, including: docs/feature-simplification/feature-support-simplification.md (SPEC path reference only), package workspaces, tsconfig, eslint.\n[Commands]\n- pnpm i\n- pnpm -w build\n- pnpm -w test\n- pnpm -w bench\n[Definition of Done]\n- Workspace builds; tests execute (empty suites OK); bench script runs and prints placeholders.\n- Lint passes; CI workflow skeleton present.",
        "testStrategy": "Smoke tests: build succeeds; unit test runner executes a trivial test; bench script prints headers.",
        "subtasks": [
          {
            "id": 1001,
            "title": "Create workspace root (pnpm, TS configs)",
            "status": "done",
            "estimatedHours": 2,
            "file": "package.json",
            "parentId": "undefined"
          },
          {
            "id": 1002,
            "title": "Init core package",
            "status": "done",
            "estimatedHours": 4,
            "file": "packages/core/package.json",
            "parentId": "undefined"
          },
          {
            "id": 1003,
            "title": "Bench harness entry",
            "status": "done",
            "estimatedHours": 4,
            "file": "scripts/bench.ts",
            "parentId": "undefined"
          },
          {
            "id": 1004,
            "title": "Docs skeleton",
            "status": "done",
            "estimatedHours": 6,
            "file": "docs/README.md",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "2",
        "title": "Dual AJV & Config Gate",
        "description": "Introduce Source vs Planning AJV instances and enforce startup parity gates.",
        "priority": "high",
        "estimatedHours": 24,
        "dependencies": [
          "8000",
          "9000",
          "9113",
          "9101",
          "9112"
        ],
        "status": "done",
        "complexityScore": 4,
        "details": "[Context] §13 startup-config-check; §12 Ajv class selection; §1 config gate.\n- spec://§13#startup-config-check\n- spec://§12#ajv-class-selection\n- spec://§1#config-gate\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§13\",\"anchors\":[\"spec://§13#startup-config-check\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§12\",\"anchors\":[\"spec://§12#ajv-class-selection\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§1\",\"anchors\":[\"spec://§1#config-gate\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Two AJV instances with identical `unicodeRegExp:true` and `validateFormats` parity.\n- Align `multipleOfPrecision` to PlanOptions.rational.decimalPrecision on both instances.\n- Fail with AJV_FLAGS_MISMATCH and include diffs per §13 when deviations are detected.\n[Deliverables]\n- packages/core/src/util/ajv-source.ts\n- packages/core/src/util/ajv-planning.ts\n- packages/core/src/util/ajv-gate.ts (validation of flags; diagnostic assembly)\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Gate refuses mismatched flags/classes; exports include ajvMajor and diff payloads; unit tests cover unicodeRegExp and multipleOfPrecision parity.",
        "testStrategy": "Unit: simulate mismatched flags (e.g., unicodeRegExp:false) → AJV_FLAGS_MISMATCH. Draft mapping to Ajv*/Ajv2020. Integration: successful compile on simple schemas; failure on external $ref remains for modes task.",
        "subtasks": [
          {
            "id": 2001,
            "title": "Source AJV factory",
            "status": "done",
            "estimatedHours": 6,
            "file": "packages/core/src/util/ajv-source.ts",
            "parentId": "undefined"
          },
          {
            "id": 2002,
            "title": "Planning AJV factory",
            "status": "done",
            "estimatedHours": 8,
            "file": "packages/core/src/util/ajv-planning.ts",
            "parentId": "undefined"
          },
          {
            "id": 2003,
            "title": "Startup config checker",
            "status": "done",
            "estimatedHours": 10,
            "file": "packages/core/src/util/ajv-gate.ts",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2025-10-12T20:00:58.449Z"
      },
      {
        "id": "3",
        "title": "Utils: RNG, rationals, JSON-safe",
        "description": "Provide deterministic RNG, exact rational helpers with fallbacks, and JSON-safe logging.",
        "priority": "high",
        "estimatedHours": 12,
        "dependencies": [
          "8000",
          "9000",
          "9115",
          "9123",
          "9108"
        ],
        "status": "done",
        "complexityScore": 3,
        "details": "[Context] §15 RNG; §8 numbers/multipleOf; §23 interfaces.\n- spec://§15#rng\n- spec://§8#numbers-multipleof\n- spec://§23#plan-options\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§15\",\"anchors\":[\"spec://§15#rng\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§8\",\"anchors\":[\"spec://§8#numbers-multipleof\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- xorshift32 seeded with (seed >>> 0) ^ fnv1a32(canonPath); export next() and float in [0,1).\n- Rationals: exact math with caps; decimal/float fallback with ε = 10^(−decimalPrecision). Log RAT_* diagnostics via caller.\n- jsonSafeReplacer for BigInt.\n[Deliverables]\n- packages/core/src/util/rng.ts\n- packages/core/src/util/rational.ts\n- packages/core/src/util/json-safe.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Deterministic RNG across runs; rational unit tests for lcm/gcd and epsilon tolerance; JSON-safe logs stringify BigInt.\n<info added on 2025-10-13T11:31:12.703Z>\nI'll analyze the codebase first to understand the current state and then provide the update based on the user's request.Based on my analysis of the codebase, the user request indicates that the rational helpers, JSON-safe replacer, and RNG utilities have been successfully implemented. The files I examined confirm this:\n\n- `/packages/core/src/util/rng.ts`: Contains XorShift32 class with fnv1a32 hashing and deterministic float generation\n- `/packages/core/src/util/rational.ts`: Implements gcd/lcm, reduce, quantizeDecimal, and epsilon tolerance functions\n- `/packages/core/src/util/json-safe.ts`: Provides jsonSafeReplacer for BigInt serialization\n\n[Progress Update]\nImplementation completed with deliverables at expected locations. RNG utility (packages/core/src/util/rng.ts) provides xorshift32 with fnv1a32 seeding as specified. Rational helpers (packages/core/src/util/rational.ts) deliver exact arithmetic with gcd/lcm/reduce functions plus decimal fallback mechanisms with configurable epsilon tolerance. JSON-safe utilities (packages/core/src/util/json-safe.ts) handle BigInt serialization and rational number display formatting. All modules align with §8 multipleOf semantics, §15 RNG determinism requirements, and §23 interface specifications.\n</info added on 2025-10-13T11:31:12.703Z>\n<info added on 2025-10-13T11:39:35.206Z>\nI'll analyze the codebase first to understand the current implementation and then provide the update.Based on my analysis of the codebase, I can see that the implementation is indeed complete with all deliverables in place and comprehensive test coverage. Here's the new text that should be appended to the task details:\n\n[Final Implementation Status - 2025-10-13]\nTASK COMPLETED - All implementation and testing objectives achieved:\n\n**Delivered Files:**\n✅ packages/core/src/util/rng.ts - XorShift32 with fnv1a32 seeding per §15\n✅ packages/core/src/util/rational.ts - gcd/lcm/reduce + epsilon tolerance helpers per §8  \n✅ packages/core/src/util/json-safe.ts - BigInt replacer + rational serialization\n\n**Test Coverage (33 total tests):**\n✅ packages/core/src/util/__tests__/rng.test.ts - 19 tests (hash accuracy, determinism, edge cases, distribution)\n✅ packages/core/src/util/__tests__/rational.test.ts - 6 tests (gcd/lcm/reduce + epsilon tolerance)\n✅ packages/core/src/util/__tests__/json-safe.test.ts - 2 tests (BigInt serialization)\n✅ packages/core/src/util/__tests__/ajv-gate.test.ts - 6 existing tests continue to pass\n\n**Quality Gates Passed:**\n✅ TypeScript compilation clean (tsc --noEmit)\n✅ All 33 tests pass in test suite\n✅ Deterministic RNG verified across runs with fixed seeds\n✅ Rational arithmetic with exact gcd/lcm and epsilon boundary testing\n✅ JSON-safe BigInt stringification confirmed\n\n**Spec Compliance Verified:**\n✅ §15 RNG requirements: fnv1a32 + XorShift32 deterministic seeding\n✅ §8 multipleOf: exact rational math with epsilon fallback mechanisms  \n✅ §23 interfaces: proper TypeScript exports and function signatures\n\nReady for integration with downstream tasks requiring deterministic utilities.\n</info added on 2025-10-13T11:39:35.206Z>",
        "testStrategy": "Property tests for RNG distribution determinism given fixed seed; unit tests for multipleOf tolerance boundaries; JSON-safe replacer snapshot tests.",
        "subtasks": [
          {
            "id": 3001,
            "title": "Implement RNG (xorshift32 + fnv1a32)",
            "status": "done",
            "estimatedHours": 4,
            "file": "packages/core/src/util/rng.ts",
            "parentId": "undefined"
          },
          {
            "id": 3002,
            "title": "Implement rational helpers",
            "status": "done",
            "estimatedHours": 6,
            "file": "packages/core/src/util/rational.ts",
            "parentId": "undefined"
          },
          {
            "id": 3003,
            "title": "JSON-safe replacer",
            "status": "done",
            "estimatedHours": 2,
            "file": "packages/core/src/util/json-safe.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "4",
        "title": "Structural hashing & stable-hash",
        "description": "Implement structural hashing for uniqueItems and stable schema hashing for cache.",
        "status": "done",
        "dependencies": [
          "8000",
          "9000",
          "9110",
          "9114",
          "9124"
        ],
        "priority": "high",
        "details": "[Context] §10 structural hashing; §14 stable-hash.\n- spec://§10#structural-hashing\n- spec://§14#stable-hash\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§10\",\"anchors\":[\"spec://§10#structural-hashing\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§14\",\"anchors\":[\"spec://§14#stable-hash\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- SHA-256 over canonical JSON (sorted keys, arrays in order, -0→0, BigInt stringified); confirm collisions with deepEqual.\n[Critical Path]\n- HIGH PRIORITY: This task blocks Task 8 (Composition Engine), Task 10 (Repair Engine), and Task 11 (Pipeline Orchestrator)\n- Structural hashing is required for uniqueItems deduplication in the Repair Engine\n- Stable-hash is required for the cache system in the Composition Engine\n- Current array-generator.ts uses JSON.stringify for uniqueItems (lines 364, 603-607) - needs replacement with structural hash\n- CacheOptions in types/options.ts references hash-based caching (line 68) - needs stable-hash implementation\n[Implementation Context]\n- packages/core/src/generator/types/array-generator.ts currently implements uniqueItems using JSON.stringify\n- packages/core/src/types/options.ts defines CacheOptions with hashIfBytesLt setting\n- No repair engine or composition engine directories exist yet - this task must complete before they can be implemented\n[Deliverables]\n- packages/core/src/util/struct-hash.ts\n- packages/core/src/util/stable-hash.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- uniqueItems de-dupe via hash+confirm; stableHash returns deterministic digest; tests cover -0 normalization.",
        "testStrategy": "Unit: hashing determinism; collision buckets with deepEqual confirmation; array/object ordering tests. Integration: replace JSON.stringify usage in array-generator.ts with structural hashing; verify cache system can use stable-hash for schema keys.",
        "subtasks": [
          {
            "id": 1,
            "title": "Structural hash for instances",
            "description": "Implement structural hashing utility for JavaScript values used in uniqueItems deduplication",
            "dependencies": [],
            "details": "Create packages/core/src/util/struct-hash.ts with SHA-256 based structural hashing for JavaScript values. Must handle canonical JSON normalization (sorted keys, arrays in order, -0→0, BigInt stringified). Include collision detection with deepEqual confirmation. Replace JSON.stringify usage in array-generator.ts lines 364, 603-607 with this implementation.",
            "status": "done",
            "testStrategy": "Unit tests for deterministic hashing, collision handling, edge cases with -0, BigInt, deep objects/arrays",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Stable hash for schema",
            "description": "Implement stable schema hashing for cache system used by Composition Engine",
            "dependencies": [],
            "details": "Create packages/core/src/util/stable-hash.ts for deterministic schema digest generation. Must integrate with CacheOptions.hashIfBytesLt setting in types/options.ts. Provide consistent hashing for schema objects to enable efficient caching in the composition engine pipeline stage.",
            "status": "done",
            "testStrategy": "Unit tests for schema hashing consistency, deterministic output across runs, integration with cache options",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "5",
        "title": "PtrMap canon→original",
        "description": "Bidirectional pointer mapping between canonical and original schema pointers.",
        "priority": "medium",
        "estimatedHours": 8,
        "dependencies": [
          "8000",
          "9000",
          "9107",
          "9122"
        ],
        "status": "done",
        "complexityScore": 2,
        "details": "[Context] §7 contract exports ptrMap/revPtrMap; §22 deliverables.\n- spec://§7#contract\n- spec://§22#packages-core\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§7\",\"anchors\":[\"spec://§7#contract\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Provide mapCanonToOrig and reverse, plus toOriginalByWalk (longest-prefix walk).\n[Deliverables]\n- packages/core/src/util/ptr-map.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Unit tests cover reverse-walk across nested paths; stable behavior.",
        "testStrategy": "Unit: mapping inlining, longest-prefix reverse resolution; golden tests using tiny canonical vs original trees.",
        "subtasks": [
          {
            "id": 5001,
            "title": "Pointer maps and reverse walk",
            "status": "done",
            "estimatedHours": 8,
            "file": "packages/core/src/util/ptr-map.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "6",
        "title": "Metrics & diagnostic envelope",
        "description": "Diagnostics envelope `{code, canonPath, details?}`, metrics collection, verbosity toggle.",
        "priority": "high",
        "estimatedHours": 16,
        "dependencies": [
          "8000",
          "9000",
          "9115",
          "9119",
          "9101"
        ],
        "status": "done",
        "complexityScore": 3,
        "details": "[Context] §19 envelope & payloads; §15 metrics; §1 acceptance signals.\n- spec://§19#envelope, spec://§19#payloads\n- spec://§15#metrics, spec://§1#acceptance\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§19\",\"anchors\":[\"spec://§19#envelope\",\"spec://§19#payloads\"],\"notes\":\"no-embed; fetch-on-demand\"}\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§15\",\"anchors\":[\"spec://§15#metrics\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Envelope must never duplicate canonPath inside details.\n- Implement metrics fields (normalizeMs..p95LatencyMs) and counters; support verbosity toggle (CI verbose vs runtime normal) without changing shapes.\n[Deliverables]\n- packages/core/src/util/metrics.ts\n- packages/core/src/diag/codes.ts (type tags)\n- packages/core/src/diag/validate.ts (mini-schema assertions for §19.1 where practical)\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Diagnostics serialize with correct envelope; metrics accumulate across phases; toggle reduces payload volume but fields exist.",
        "testStrategy": "Unit: envelope guard (no canonPath duplication in details); metrics counters increments; snapshot tests for verbosity modes.",
        "subtasks": [
          {
            "id": 6001,
            "title": "Metrics utility",
            "status": "done",
            "estimatedHours": 8,
            "file": "packages/core/src/util/metrics.ts",
            "parentId": "undefined"
          },
          {
            "id": 6002,
            "title": "Diagnostics code schema helpers",
            "status": "done",
            "estimatedHours": 4,
            "file": "packages/core/src/diag/codes.ts",
            "parentId": "undefined"
          },
          {
            "id": 6003,
            "title": "Diagnostics validator (payload spot-checks)",
            "status": "done",
            "estimatedHours": 4,
            "file": "packages/core/src/diag/validate.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "7",
        "title": "Normalizer",
        "description": "Draft unification, boolean/trivial simplifications with unevaluated guards, conditional rewrite (safe), propertyNames rewrite (P0: enum-only).",
        "priority": "high",
        "estimatedHours": 48,
        "dependencies": [
          "5",
          "6",
          "13",
          "8000",
          "9000",
          "9107",
          "9108",
          "9112"
        ],
        "status": "done",
        "complexityScore": 5,
        "details": "[Context] §7 pass order; conditionals rewrite; propertyNames rewrite; note codes; §8 interplay.\n- spec://§7#pass-order, spec://§7#conditionals-rewrite, spec://§7#object-keywords-pnames-rewrite, spec://§7#note-codes\n- spec://§8#regex-complexity-cap\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§7\",\"anchors\":[\"spec://§7#pass-order\",\"spec://§7#conditionals-rewrite\",\"spec://§7#object-keywords-pnames-rewrite\",\"spec://§7#note-codes\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Unevaluated* guard blocks simplifications and conditional rewrites where specified.\n- PropertyNames rewrite: **P0 implements enum-only**; anchored-pattern form is deferred to **P2 (#23)**.\n- When rewrite applies, log PNAMES_REWRITE_APPLIED and keep original node; add-only synthetic entries.\n[Deliverables]\n- packages/core/src/transform/schema-normalizer.ts\n- packages/core/src/parser/json-schema-parser.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Notes emitted per §7; enum-based rewrite adds synthetic patternProperties + AP:false in canonical view; no semantic drift in AJV final validation.",
        "testStrategy": "Golden tests on notes; rewrite acceptance/refusal; guard with unevaluated*; draft conversions; size-1 enum→const in canonical view only.",
        "subtasks": [
          {
            "id": 7001,
            "title": "Normalizer core (passes, guards, notes)",
            "status": "done",
            "estimatedHours": 32,
            "file": "packages/core/src/transform/schema-normalizer.ts",
            "parentId": "undefined"
          },
          {
            "id": 7002,
            "title": "Lean JSON Schema parser",
            "status": "done",
            "estimatedHours": 16,
            "file": "packages/core/src/parser/json-schema-parser.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "8",
        "title": "Composition Engine",
        "description": "Build effective view, CoverageIndex (has/enumerate), branch selection, early-unsat hints, caps; AP:false must-cover and Strict/Lax behaviors.",
        "status": "done",
        "dependencies": [
          "2",
          "3",
          "4",
          "6",
          "7",
          "8000",
          "9000",
          "9107",
          "9108",
          "9111",
          "9113",
          "9114",
          "9115"
        ],
        "priority": "high",
        "details": "[Context] §8 coverage-index-export/enumerate; AP:false must-cover and fail-fast; branch-selection; oneOf exclusivity (Compose side); regex caps; §14 memo keys.\n- spec://§8#coverage-index-export, spec://§8#coverage-index-enumerate, spec://§8#apfalse-must-cover, spec://§8#branch-selection, spec://§8#oneof-exclusivity, spec://§8#regex-complexity-cap\n- spec://§14#planoptionssubkey\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§8\",\"anchors\":[\"spec://§8#coverage-index-export\",\"spec://§8#coverage-index-enumerate\",\"spec://§8#apfalse-must-cover\",\"spec://§8#branch-selection\",\"spec://§8#oneof-exclusivity\",\"spec://§8#regex-complexity-cap\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Export CoverageIndex for every object; enumerate only when provably finite by allowed sources; provenance sorted.\n- Strict fail-fast AP_FALSE_UNSAFE_PATTERN only under presence pressure and only when Safe set is empty; Lax warns.\n- Score-only invariants: always record tiebreakRand (even when |T|=1); budget.skipped=true; limit per Top-K calc.\n- **DEPENDENCY**: Requires normalized schema output from Normalizer (task 7) to build effective view and CoverageIndex.\n[Deliverables]\n- packages/core/src/transform/composition-engine.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Deterministic branch selection; CoverageIndex.has/enumerate pure; diagnostics emitted with correct locus; caps limited to compose-time set.",
        "testStrategy": "Unit: enumerate order and provenance; AP:false safe proof vs fail-fast routing; score-only path with tiebreakRand present; early-unsat hints payloads shapes; memo key includes PlanOptionsSubKey.",
        "subtasks": [
          {
            "id": 1,
            "title": "Effective view & CoverageIndex",
            "description": "Implement core effective view computation and CoverageIndex data structure with has/enumerate methods",
            "dependencies": [],
            "details": "Build the core effective view computation that processes normalized schemas from the Normalizer (task 7). Implement CoverageIndex class with has() and enumerate() methods, ensuring enumerate only operates on provably finite sources. Handle AP:false must-cover requirements with Safe/Unsafe pattern detection. Export CoverageIndex for every object schema processed.",
            "status": "done",
            "testStrategy": "Unit tests for CoverageIndex.has/enumerate purity, effective view computation correctness, and finite source validation",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Branch selector & diagnostics",
            "description": "Implement deterministic branch selection with score-only invariants and diagnostic emission",
            "dependencies": [],
            "details": "Implement branch selection algorithm with deterministic tiebreakRand recording (even for |T|=1 cases). Handle Strict vs Lax behaviors for AP_FALSE_UNSAFE_PATTERN routing. Implement early-unsat hints generation and diagnostic emission with correct locus information. Ensure memo keys include PlanOptionsSubKey for proper caching.",
            "status": "done",
            "testStrategy": "Unit tests for deterministic branch selection, tiebreakRand presence, Strict/Lax routing behavior, and diagnostic locus accuracy",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2025-10-15T18:54:14.278Z"
      },
      {
        "id": "9",
        "title": "Generator",
        "description": "Foundry generator honoring effective view, pattern witness, minimal width/length, if-aware-lite.",
        "status": "done",
        "dependencies": [
          "8",
          "8000",
          "9000",
          "9109",
          "9108",
          "9113",
          "9115",
          "3",
          "6"
        ],
        "priority": "high",
        "details": "[Context] §9 generator, if-aware-lite, pattern-witness-selection; arrays contains; §8 oneOf exclusivity (later step logs exclusivityRand in Repair phase). Requires dependency on task 8 (Composition Engine) to access effective view and CoverageIndex from the Composition Engine for generating data that honors schema constraints.\n- spec://§9#if-aware-lite, spec://§9#pattern-witness-selection, spec://§9#arrays-contains\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§9\",\"anchors\":[\"spec://§9#if-aware-lite\",\"spec://§9#pattern-witness-selection\",\"spec://§9#arrays-contains\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Pattern witness bounded search; emit COMPLEXITY_CAP_PATTERNS when capped; Unicode code point length.\n- Minimal-width objects with must-cover + unevaluated guards.\n- Access to effective view and CoverageIndex from Composition Engine (task 8) for constraint-aware generation.\n[Deliverables]\n- packages/core/src/generator/foundry-generator.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Deterministic outputs for fixed (seed, options); metrics.patternWitnessTried increments when enabled.\n- Integration with Composition Engine outputs for effective schema processing.",
        "testStrategy": "Unit: witness ordering/capping; object property order (required then optional, UTF-16); arrays contains with uniqueItems handling.",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement generator core",
            "description": "Core generator implementation that integrates with Composition Engine effective view",
            "dependencies": [],
            "details": "Implement the foundry generator that consumes the effective view and CoverageIndex from the Composition Engine to generate schema-compliant data. Must honor pattern witness selection, minimal width/length constraints, and if-aware-lite processing.",
            "status": "done",
            "testStrategy": "Unit tests for core generation logic with deterministic seed handling",
            "parentId": "undefined",
            "updatedAt": "2025-10-22T21:24:51.252Z"
          }
        ],
        "updatedAt": "2025-10-22T21:24:51.252Z"
      },
      {
        "id": "10",
        "title": "Repair Engine",
        "description": "AJV-driven repairs, epsilon logging, AP:false rename guard with CoverageIndex, unevaluated evaluation guard.",
        "status": "done",
        "dependencies": [
          "2",
          "3",
          "4",
          "6",
          "8",
          "8000",
          "9000",
          "9108",
          "9110",
          "9113"
        ],
        "priority": "high",
        "details": "[Context] §10 mapping; epsilon logging; propertyNames rename guard; MUSTCOVER index missing; §9 unevaluated evaluation guard.\n- spec://§10#mapping, spec://§10#epsilon-logging, spec://§10#propertynames-rename-guard, spec://§10#mustcover-index-missing\n- spec://§9#objects-minimal-width (guard interplay) [contextual]\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§10\",\"anchors\":[\"spec://§10#mapping\",\"spec://§10#epsilon-logging\",\"spec://§10#propertynames-rename-guard\",\"spec://§10#mustcover-index-missing\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Log epsilon exactly as \"1e-<decimalPrecision>\" for non-integer nudges; optional delta for integers.\n- Under AP:false + guard true, require ctx.isNameInMustCover(canonPath,n) before rename; else emit MUSTCOVER_INDEX_MISSING{guard:true}.\n- Evaluation guard for additions/renames when unevaluatedProperties:false applies.\n- Integration with Composition Engine's CoverageIndex API for AP:false rename guard implementation.\n[Deliverables]\n- packages/core/src/repair/repair-engine.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Repairs idempotent; logs include canonPath and origPath; rename preflight per §10 and diagnostics conform to §19.1.\n- CoverageIndex integration for must-cover property name validation under additionalProperties:false constraints.",
        "testStrategy": "Unit: epsilon logging tests (float vs integer); enum-first selection; rename blocked by must-cover or evaluation guard; preflight branch/dependent failures; CoverageIndex integration for AP:false guard validation.",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement repair actions & guards",
            "description": "Implement AJV-driven repair actions with CoverageIndex integration for AP:false rename guards and unevaluated evaluation guards.",
            "dependencies": [],
            "details": "Create repair-engine.ts with AJV-driven repair logic, epsilon logging, and integration with Composition Engine's CoverageIndex for property name validation under additionalProperties:false constraints. Must implement ctx.isNameInMustCover binding and MUSTCOVER_INDEX_MISSING diagnostic emission.",
            "status": "done",
            "testStrategy": "Unit tests for repair actions, epsilon logging, CoverageIndex integration, and guard validation.",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "11",
        "title": "Pipeline Orchestrator",
        "description": "Wire Normalize → Compose → Generate → Repair → Validate; pass metrics and diagnostics through. Pipeline orchestration is wired but pending integration of task 9 generator and task 10 repair engines; revisit once those land to replace stubs and tighten dual AJV parity.",
        "status": "done",
        "dependencies": [
          "2",
          "5",
          "6",
          "7",
          "9",
          "10",
          "8000",
          "9000",
          "9101",
          "9106",
          "9113",
          "9115"
        ],
        "priority": "high",
        "details": "[Context] §4 pipeline; §6 phases; §1 acceptance; §15 metrics.\n- spec://§4#pipeline, spec://§6#phases, spec://§1#acceptance, spec://§15#metrics\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§4\",\"anchors\":[\"spec://§4#pipeline\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Final AJV validate against original; support Lax/Strict behaviors routed by Modes task.\n- Wire together Normalize → Compose → Generate → Repair → Validate stages from dependency tasks.\n- Integrate with existing FoundryGenerator structure in packages/core/src/generator/foundry-generator.ts\n- Preserve existing PipelineStage enum and metrics collection patterns\n- Pipeline orchestration framework is implemented but uses stubs for Generator and Repair stages pending task 9 and task 10 completion\n[Deliverables]\n- packages/core/src/index.ts (main orchestrator entry point)\n- Enhanced packages/core/src/generator/foundry-generator.ts with new pipeline stages\n- packages/core/src/pipeline/orchestrator.ts (pipeline coordination logic)\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test; pnpm -w bench\n[Definition of Done]\n- End-to-end run returns diagnostics+metrics and valid instances on simple cases; errors propagate with correct codes.\n- All five pipeline stages (Normalize, Compose, Generate, Repair, Validate) are wired together\n- Integration with task 2 (Dual AJV), task 7 (Normalizer), task 8 (Composition Engine), task 9 (Generator), and task 10 (Repair Engine)\n- Dual AJV parity will be tightened once Generator and Repair engine implementations replace current stubs",
        "testStrategy": "Integration smoke: simple schema end-to-end; metrics fields all present; validationsPerRow ≥ 1 unless Lax skip path applies (to be added in task #12). Test all five pipeline stages execute in sequence with proper metrics collection. Current tests use stubbed implementations for Generator and Repair stages.",
        "subtasks": [
          {
            "id": 4,
            "title": "Integrate Generator stage",
            "description": "Wire task 9 (Generator) implementation into the pipeline orchestrator",
            "dependencies": [
              3
            ],
            "details": "Integrate the Generator from task 9 as the third stage in the pipeline. Handle deterministic seeded generation, enum/const precedence, and if-aware-lite generation. Maintain compatibility with existing generator structure in foundry-generator.ts. Currently using stub implementation pending task 9 completion.",
            "status": "done",
            "testStrategy": "Test generator stage integration with deterministic output verification and enum precedence handling",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Integrate Repair Engine stage",
            "description": "Wire task 10 (Repair Engine) implementation into the pipeline orchestrator",
            "dependencies": [
              4
            ],
            "details": "Integrate the Repair Engine from task 10 as the fourth stage in the pipeline. Handle AJV-driven corrections, idempotent repairs, rational snapping, and structural deduplication for uniqueItems. Implement repair budgeting and graceful degradation. Currently using stub implementation pending task 10 completion.",
            "status": "done",
            "testStrategy": "Test repair stage integration with various validation failure scenarios and repair budget limits",
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Integrate Dual AJV Validation stage",
            "description": "Wire task 2 (Dual AJV) implementation as the final validation stage",
            "dependencies": [
              5
            ],
            "details": "Integrate the Dual AJV system from task 2 as the final validation stage. Ensure validation against original schema, handle Source and Planning AJV instances, and implement proper error reporting with pointer mapping and caching.",
            "status": "done",
            "testStrategy": "Test validation stage integration with both Source and Planning AJV instances, verify validation against original schema",
            "parentId": "undefined"
          },
          {
            "id": 7,
            "title": "Implement metrics aggregation",
            "description": "Aggregate metrics from all pipeline stages into comprehensive PipelineMetrics",
            "dependencies": [
              6
            ],
            "details": "Collect and aggregate metrics from all five pipeline stages (normalizeMs, composeMs, generateMs, repairMs, validateMs). Include validationsPerRow, repairPassesPerRow, branchTrialsTried, and memory usage. Ensure compatibility with existing PipelineMetrics interface.",
            "status": "done",
            "testStrategy": "Test metrics collection from all stages, verify metric accuracy and completeness",
            "parentId": "undefined"
          },
          {
            "id": 8,
            "title": "Implement error propagation",
            "description": "Ensure proper error handling and propagation across all pipeline stages",
            "dependencies": [
              7
            ],
            "details": "Implement comprehensive error handling that preserves error context across pipeline stages. Handle FoundryError types from each stage, maintain error codes, and ensure diagnostic information is properly aggregated and reported.",
            "status": "done",
            "testStrategy": "Test error propagation from each pipeline stage, verify error context preservation and proper error codes",
            "parentId": "undefined"
          },
          {
            "id": 9,
            "title": "Replace Generator stub with task 9 implementation",
            "description": "Replace stub Generator implementation with actual task 9 Generator once completed",
            "dependencies": [
              8
            ],
            "details": "Once task 9 (Generator) is completed, replace the current stub implementation in the pipeline orchestrator with the actual Generator implementation. Ensure proper integration with the pipeline flow, maintain deterministic seeded generation, and verify enum/const precedence handling works correctly.",
            "status": "done",
            "testStrategy": "Integration test to verify Generator stage replacement maintains pipeline functionality and deterministic output",
            "parentId": "undefined"
          },
          {
            "id": 10,
            "title": "Replace Repair Engine stub with task 10 implementation",
            "description": "Replace stub Repair Engine implementation with actual task 10 Repair Engine once completed",
            "dependencies": [
              9
            ],
            "details": "Once task 10 (Repair Engine) is completed, replace the current stub implementation in the pipeline orchestrator with the actual Repair Engine implementation. Ensure proper AJV-driven corrections, idempotent repairs, and repair budgeting work correctly within the pipeline flow.",
            "status": "done",
            "testStrategy": "Integration test to verify Repair Engine stage replacement maintains pipeline functionality and proper repair behavior",
            "parentId": "undefined"
          },
          {
            "id": 11,
            "title": "Tighten dual AJV parity",
            "description": "Review and tighten dual AJV parity once Generator and Repair Engine implementations are integrated",
            "dependencies": [
              10
            ],
            "details": "After integrating the actual Generator and Repair Engine implementations, review the dual AJV validation parity to ensure consistent behavior between Source and Planning AJV instances. Address any discrepancies and ensure proper validation against the original schema throughout the complete pipeline.",
            "status": "done",
            "testStrategy": "Comprehensive validation testing to verify dual AJV parity across all pipeline stages with real implementations",
            "parentId": "undefined"
          },
          {
            "id": 1,
            "title": "Compose pipeline entrypoint",
            "description": "Create main orchestrator entry point in packages/core/src/index.ts that coordinates the five-stage pipeline",
            "dependencies": [],
            "details": "Implement the high-level orchestrator function that coordinates Normalize → Compose → Generate → Repair → Validate stages. This should integrate with the existing FoundryGenerator structure and maintain compatibility with current PipelineStage enum and metrics collection patterns. The orchestrator should handle stage dependencies, error propagation, and metrics aggregation across all pipeline stages.",
            "status": "done",
            "testStrategy": "Unit test for pipeline coordination logic, integration test for end-to-end execution with metrics collection",
            "parentId": "undefined",
            "updatedAt": "2025-10-14T18:37:31.916Z"
          },
          {
            "id": 2,
            "title": "Integrate Normalizer stage",
            "description": "Wire task 7 (Normalizer) implementation into the pipeline orchestrator",
            "dependencies": [
              1
            ],
            "details": "Integrate the Normalizer from task 7 as the first stage in the pipeline. Handle draft unification, boolean/trivial simplifications, conditional rewrite options, and propertyNames rewrite. Ensure proper error handling and metrics collection for the normalization stage.",
            "status": "done",
            "testStrategy": "Test normalization stage integration with various schema types and conditional rewrite scenarios",
            "parentId": "undefined",
            "updatedAt": "2025-10-14T18:37:38.010Z"
          },
          {
            "id": 3,
            "title": "Integrate Composition Engine stage",
            "description": "Wire task 8 (Composition Engine) implementation into the pipeline orchestrator [Updated: 10/14/2025]",
            "dependencies": [
              2
            ],
            "details": "Integrate the Composition Engine from task 8 as the second stage in the pipeline. Handle effective view building, must-cover additionalProperties:false, bag contains semantics, and rational multipleOf calculations. Ensure proper data flow from Normalizer to Composition stage.\n<info added on 2025-10-14T18:19:41.172Z>\nLet me analyze the codebase to understand the current project structure and implementation patterns before updating the subtask status.Based on my analysis of the codebase, I can see that:\n\n1. **The Composition Engine is implemented** in `/Users/fstepho/dev/foundry/foundrydata/packages/core/src/transform/composition-engine.ts` - it exports a `compose` function and `CompositionEngine` class.\n\n2. **Pipeline integration exists** in `/Users/fstepho/dev/foundry/foundrydata/test/__tests__/integration/pipeline/full-pipeline.test.ts` showing parsing → generation → validation flow.\n\n3. **The project structure** uses a monorepo with packages in `packages/core/src/` for core functionality.\n\n4. **Task validation commands** exist in `package.json:32-33` with `task-ready` and `task-complete` scripts.\n\nThe user request is simply \"set status to in-progress\" - this is a status change request that doesn't require detailed implementation information, just an acknowledgment that work has begun on integrating the Composition Engine into the pipeline orchestrator.\n\nStarted integrating Composition Engine from task 8 into pipeline orchestrator as second stage. Working on wiring data flow from Normalizer to Composition stage with proper handling of effective view building, additionalProperties:false semantics, and rational multipleOf calculations.\n</info added on 2025-10-14T18:19:41.172Z>",
            "status": "done",
            "testStrategy": "Test composition stage integration with complex object patterns and array constraints",
            "parentId": "undefined",
            "updatedAt": "2025-10-14T18:37:44.402Z"
          }
        ]
      },
      {
        "id": "12",
        "title": "Modes & External $ref",
        "description": "Implement Strict vs Lax behaviors and external $ref skip-eligibility probe.",
        "priority": "medium",
        "estimatedHours": 12,
        "dependencies": [
          "13",
          "8000",
          "9000",
          "9111",
          "9112"
        ],
        "status": "pending",
        "complexityScore": 3,
        "details": "[Context] §11 modes; external-ref-probe; draft classification for internal vs external.\n- spec://§11#external-ref-probe\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§11\",\"anchors\":[\"spec://§11#external-ref-probe\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Strict: error EXTERNAL_REF_UNRESOLVED; Lax: warn + attempt; heuristic probe to skip validation only when all conditions met; set validationsPerRow=0 when skipped.\n[Deliverables]\n- packages/core/src/util/modes.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Unit tests cover skip eligibility and ref exemplar selection; Strict path aborts planning.",
        "testStrategy": "Unit: compile fail solely due to external refs triggers skip in Lax with metrics set; negative case with mixed errors does not skip.",
        "subtasks": [
          {
            "id": 12001,
            "title": "Implement mode switch and external-ref handling",
            "status": "pending",
            "estimatedHours": 12,
            "file": "packages/core/src/util/modes.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "13",
        "title": "Draft handling & $dynamic*",
        "description": "Dialect detection, Ajv class selection, bounded in-document $dynamicRef binding (planning-only).",
        "status": "done",
        "dependencies": [
          "8000",
          "9000",
          "9112"
        ],
        "priority": "medium",
        "details": "[Context] §12 Ajv class selection; bounded in-document dynamic scope.\n- spec://§12#ajv-class-selection\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§12\",\"anchors\":[\"spec://§12#ajv-class-selection\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Match Ajv class to dialect; optional bounded dynamic binding (depth ≤ guards.maxDynamicScopeHops), planning-only substitution to fragment $ref.\n- Leverage existing dialect detection system in packages/core/src/util/ajv-source.ts with JsonSchemaDialect type and createAjvByDialect function\n- Integrate with current GuardsOptions structure in packages/core/src/types/options.ts for depth bounds\n[Deliverables]\n- packages/core/src/util/draft.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Emits DYNAMIC_SCOPE_BOUNDED when bound; otherwise DYNAMIC_PRESENT; no cross-document I/O.\n- Unit tests pass with existing vitest framework\n- TypeScript compilation succeeds with existing tsconfig",
        "testStrategy": "Unit: binding success/failure cases (with/without $ref on ancestor path); depth bound respected. Use vitest framework matching existing test structure in packages/core/src/**/__tests__/ directories. Test against all supported dialects (draft-07, 2019-09, 2020-12, draft-04).",
        "subtasks": [
          {
            "id": 1,
            "title": "Create draft detection and Ajv class selector",
            "description": "Implement functions to detect JSON Schema dialect and select appropriate Ajv class, building on existing ajv-source.ts infrastructure.",
            "dependencies": [],
            "details": "Create packages/core/src/util/draft.ts with functions that leverage the existing JsonSchemaDialect type, createAjvByDialect, and getAjvClassLabel functions from ajv-source.ts. Implement dialect detection from schema $schema property and provide Ajv class selection interface that integrates with the current architecture.",
            "status": "done",
            "testStrategy": "Unit tests for each supported dialect detection and corresponding Ajv class selection",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Implement bounded $dynamicRef scope resolver",
            "description": "Add bounded in-document $dynamicRef binding with configurable depth limits using existing GuardsOptions.",
            "dependencies": [
              1
            ],
            "details": "Implement bounded dynamic scope resolution that respects depth limits from GuardsOptions.maxDynamicScopeHops (add this field to GuardsOptions interface in types/options.ts if not present). Provide planning-only substitution to fragment $ref without cross-document I/O. Emit DYNAMIC_SCOPE_BOUNDED when successfully bound within limits, DYNAMIC_PRESENT otherwise.",
            "status": "done",
            "testStrategy": "Unit tests covering depth boundary conditions, successful/failed binding scenarios, and ancestor path resolution with/without $ref",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "14",
        "title": "Cache Strategy",
        "description": "Implement hierarchical caches and memo keys including PlanOptionsSubKey and AJV flags.",
        "priority": "high",
        "estimatedHours": 16,
        "dependencies": [
          "2",
          "3",
          "4",
          "8000",
          "9000",
          "9114",
          "9115"
        ],
        "status": "done",
        "complexityScore": 3,
        "details": "[Context] §14 hierarchy; cache keys; PlanOptionsSubKey canonicalization.\n- spec://§14#hierarchy, spec://§14#cache-keys, spec://§14#planoptionssubkey\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§14\",\"anchors\":[\"spec://§14#planoptionssubkey\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Include AJV.major, class/dialect, full flag set, and PlanOptionsSubKey in keys. Canonicalize conditionals.strategy:'rewrite' → 'if-aware-lite'.\n[Deliverables]\n- packages/core/src/util/cache.ts\n[Commands]\n- pnpm i; pnpm -w build; pnpm -w test\n[Definition of Done]\n- Deterministic keys; separate LRU spaces for instances; memoized branch picks keyed on (canonPath, seed, AJV.major, AJV.flags, PlanOptionsSubKey[, user salt]).",
        "testStrategy": "Unit: key stability, PlanOptionsSubKey canonicalization, collisions avoided between source/planning instances.",
        "subtasks": [
          {
            "id": 14001,
            "title": "Implement caches and memoization",
            "status": "done",
            "estimatedHours": 16,
            "file": "packages/core/src/util/cache.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "15",
        "title": "Bench Harness & Gates",
        "description": "Benchmark harness and CI gates for p95 latency and memory peaks; metrics wiring.",
        "status": "done",
        "dependencies": [
          "8000",
          "9000",
          "9115",
          "9101",
          "9122",
          "11",
          "6"
        ],
        "priority": "high",
        "details": "[Context] §15 bench protocol & SLO/SLI; §1 bench SLI gate.\n- spec://§15#bench-protocol, spec://§15#slo-sli, spec://§1#bench-sli-gate\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§15\",\"anchors\":[\"spec://§15#bench-protocol\",\"spec://§15#slo-sli\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Profiles simple/medium/pathological; seeds {1,42,4242}; fail CI when thresholds exceeded.\n- Depends on Pipeline Orchestrator (task 11) for complete pipeline benchmarking.\n[Deliverables]\n- scripts/bench.ts (wired), CI job to run harness\n[Commands]\n- pnpm -w bench\n[Definition of Done]\n- Bench reports p50/p95 & memory; CI job enforces gates; measures complete pipeline performance.",
        "testStrategy": "CI dry-run with reduced iterations; local harness smoke on sample schemas.",
        "subtasks": [
          {
            "id": 1,
            "title": "Extend bench harness + CI wiring",
            "description": "Implement comprehensive benchmark harness that measures complete pipeline performance including Pipeline Orchestrator from task 11",
            "dependencies": [],
            "details": "Create benchmark harness that measures the full 5-stage pipeline (Normalize → Compose → Generate → Repair → Validate) through the Pipeline Orchestrator. Include profiles for simple/medium/pathological schemas with seeds {1,42,4242}. Wire CI job to enforce performance gates and fail when thresholds exceeded.",
            "status": "pending",
            "testStrategy": "Unit tests for harness components, integration tests with sample schemas",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2025-10-21T22:30:58.373Z"
      },
      {
        "id": "16",
        "title": "Diagnostics payload conformance",
        "description": "Enforce §19.1 mini-schemas, phase separation, and verbosity toggle exposure.",
        "status": "done",
        "dependencies": [
          "6",
          "8000",
          "9000",
          "9119",
          "9108",
          "9107"
        ],
        "priority": "high",
        "details": "[Context] §19 payloads & phase separation; §8 caps separation; verbosity toggle (also in task #6).\n- spec://§19#payloads, spec://§19#phase-separation\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§19\",\"anchors\":[\"spec://§19#payloads\",\"spec://§19#phase-separation\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Validate representative payloads; ensure REGEX_COMPLEXITY_CAPPED appears only from Normalize/Compose; COMPLEXITY_CAP_PATTERNS only from Generator.\n- Expose verbosity switch integrated with metrics (building on task 6 base implementation).\n- Implement phase separation validation ensuring diagnostic codes appear from correct pipeline stages.\n[Deliverables]\n- packages/core/src/diag/schemas.ts (payload mini-schemas)\n- augment packages/core/src/util/metrics.ts (verbosity - extends task 6)\n[Dependencies]\n- Depends on task 6 for base diagnostics envelope structure and metrics collection system\n[Commands]\n- pnpm -w test\n[Definition of Done]\n- Tests cover distinct phases for caps; toggle active without schema-shape drift; validates phase separation conformance.",
        "testStrategy": "Unit: schema validation for several codes; negative tests for misrouted caps; snapshot tests across verbosity modes; phase separation validation tests.",
        "subtasks": [
          {
            "id": 1,
            "title": "Mini-schemas & validators for diagnostics",
            "description": "Create TypeScript schemas and validators to enforce diagnostic payload conformance per §19.1",
            "dependencies": [],
            "details": "Implement mini-schemas for diagnostic payloads in packages/core/src/diag/schemas.ts. This includes validating that REGEX_COMPLEXITY_CAPPED codes only appear from Normalize/Compose stages and COMPLEXITY_CAP_PATTERNS only from Generator stage. Build validation logic that ensures phase separation requirements are met.",
            "status": "done",
            "testStrategy": "Unit tests for schema validation, negative tests for phase violations",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Verbosity toggle plumbing integration",
            "description": "Integrate verbosity toggle with existing metrics collection system from task 6",
            "dependencies": [],
            "details": "Extend the base metrics and diagnostics envelope from task 6 by adding verbosity toggle functionality to packages/core/src/util/metrics.ts. This should integrate with the existing PlanOptions.metrics boolean and provide granular control over diagnostic output detail levels without breaking existing schema shapes.",
            "status": "done",
            "testStrategy": "Snapshot tests across verbosity modes, integration tests with task 6 envelope",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Phase separation enforcement",
            "description": "Implement validation that diagnostic codes appear only from their designated pipeline phases",
            "dependencies": [
              1
            ],
            "details": "Build enforcement mechanisms to validate that diagnostic codes follow phase separation rules. Ensure REGEX_COMPLEXITY_CAPPED appears only from Normalize/Compose phases and COMPLEXITY_CAP_PATTERNS only from Generator phase. This builds on the mini-schemas from subtask 1 and integrates with the existing pipeline stages.",
            "status": "done",
            "testStrategy": "Unit tests for phase routing validation, negative tests for misrouted caps",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "17",
        "title": "Unit Tests (per section)",
        "description": "Unit test suites mirroring SPEC sections, including fuzzing for oneOf exclusivity and must-cover.",
        "status": "in-progress",
        "dependencies": [
          "7",
          "8",
          "9",
          "10",
          "8000",
          "9000",
          "9120"
        ],
        "priority": "high",
        "details": "[Context] §20 unit coverage plan.\n- spec://§20#unit\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§20\",\"anchors\":[\"spec://§20#unit\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Property-based tests using AJV as oracle for oneOf exclusivity, AP:false must-cover, contains bag.\n- Tests must validate against the original schema (not transforms)\n- Fixed RNG seeds for deterministic testing\n- Coverage should target core implementation in packages/core/src/\n[Deliverables]\n- packages/core/test/*.spec.ts\n- Unit tests for normalizer (task 7), composition engine (task 8), generator (task 9), and repair engine (task 10)\n- Property-based tests for exclusivity validation and must-cover scenarios\n[Commands]\n- pnpm -w test\n[Definition of Done]\n- ≥80% coverage on touched files; fuzz tests run deterministically with fixed seeds.\n- All core implementation modules have corresponding unit test files\n- Tests pass AJV validation against original schemas",
        "testStrategy": "Organize by section; include tests IDs suggested in §20 where applicable; use fixed RNG seeds. Target existing source files in packages/core/src/ including generator/, validator/, parser/, and types/. Build tests around current implementation structure.",
        "subtasks": [
          {
            "id": 1,
            "title": "Author core unit tests",
            "description": "Create comprehensive unit test suites for core modules including generator, validator, parser, and types",
            "dependencies": [],
            "details": "Build unit tests targeting the existing source structure in packages/core/src/. Focus on modules that support the 5-stage pipeline: generator/, validator/, parser/, and types/. Ensure tests use AJV as oracle and fixed RNG seeds for determinism.",
            "status": "in-progress",
            "testStrategy": "Target existing modules with deterministic test cases using fixed seeds",
            "parentId": "undefined",
            "updatedAt": "2025-10-22T22:34:17.927Z"
          }
        ],
        "updatedAt": "2025-10-22T22:34:17.927Z"
      },
      {
        "id": "18",
        "title": "Integration & e2e",
        "description": "End-to-end scenarios covering modes, AP:false unsafe patterns, oneOf exclusivity refinement.",
        "status": "done",
        "dependencies": [
          "8000",
          "9000",
          "9120",
          "9111",
          "9112",
          "11"
        ],
        "priority": "high",
        "details": "[Context] §20 integration; §8/§11 behaviors.\n- spec://§20#integration\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§20\",\"anchors\":[\"spec://§20#integration\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Validate Strict vs Lax external $ref handling; exclusivity tweaks logged; AP:false fail-fast vs Safe proof.\n- Test complete Pipeline Orchestrator (task 11) implementation including Normalize → Compose → Generate → Repair → Validate stages\n- Validate mode-specific behaviors routed by Modes task through Pipeline Orchestrator\n[Deliverables]\n- packages/core/test/e2e/*.spec.ts\n[Commands]\n- pnpm -w test\n[Definition of Done]\n- e2e suites pass; run logs show expected diagnostics and exclusivityRand when applicable; complete pipeline validation with all modes and AP:false patterns.",
        "testStrategy": "Implement scenarios listed in §20 integration bullets; assert payload shapes and locus. Test complete FoundryGenerator pipeline orchestration with Strict/Lax modes, external $ref handling, and AP:false unsafe patterns validation.",
        "subtasks": [
          {
            "id": 1,
            "title": "Write e2e pipeline orchestration scenarios",
            "description": "Create comprehensive e2e tests validating the complete 5-stage pipeline implementation from task 11",
            "dependencies": [],
            "details": "Implement end-to-end tests that validate the complete Pipeline Orchestrator implementation including: 1) Normalize → Compose → Generate → Repair → Validate flow; 2) Metrics collection across all stages; 3) Proper error propagation; 4) Mode-specific routing (Strict/Lax); 5) External $ref handling behaviors; 6) AP:false unsafe pattern detection and handling. Tests should reference packages/core/src/generator/foundry-generator.ts orchestration logic and validate against original schema per AJV oracle principle.",
            "status": "done",
            "testStrategy": "Integration smoke: simple schema end-to-end; metrics fields all present; validationsPerRow ≥ 1 unless Lax skip path applies. Test all five pipeline stages execute in sequence with proper metrics collection.",
            "parentId": "undefined",
            "updatedAt": "2025-10-21T21:49:38.421Z"
          }
        ],
        "updatedAt": "2025-10-21T21:49:38.421Z"
      },
      {
        "id": "19",
        "title": "Documentation",
        "description": "Author Invariants, Known-Limits, and Features docs; update README and error catalog.",
        "status": "pending",
        "dependencies": [
          "4",
          "7",
          "8",
          "9",
          "10",
          "11",
          "14",
          "17",
          "18",
          "8000",
          "9000",
          "9117",
          "9118"
        ],
        "priority": "medium",
        "details": "[Context] §17 documentation additions; §18 matrix.\n- spec://§17#invariants-doc, spec://§17#known-limits, spec://§17#features-matrix\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§17\",\"anchors\":[\"spec://§17#invariants-doc\",\"spec://§17#known-limits\",\"spec://§17#features-matrix\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Document cross-phase invariants implemented in Tasks 4-18; limits for patterns and external refs established in core pipeline; feature matrix reflecting actual implementation status.\n[Deliverables]\n- docs/Invariants.md (documenting structural hashing, normalizer guards, composition engine invariants)\n- docs/Known-Limits.md (documenting cache limits, complexity caps, pattern witness caps)\n- docs/Features.md (matrix reflecting implemented features from Tasks 4-18)\n- docs/error.md (error catalog from diagnostic envelope implementation)\n- docs/README.md (updated with actual implementation details)\n[Commands]\n- pnpm -w build\n[Definition of Done]\n- Docs build and lint; cross-referenced anchors consistent with SPEC; documentation accurately reflects implemented features from core tasks.",
        "testStrategy": "Doc linting; link check; quick human review checklist; validation that documented features match implementation in packages/core/src/*.",
        "subtasks": [
          {
            "id": 1,
            "title": "Write Invariants.md documenting cross-phase guarantees",
            "description": "Document invariants from implemented core tasks: structural hashing uniqueness guarantees, normalizer guard behaviors, composition engine coverage guarantees, pipeline metrics consistency.",
            "dependencies": [],
            "details": "Create comprehensive invariants documentation based on completed implementations in Tasks 4 (structural hashing), 7 (normalizer), 8 (composition engine), and pipeline orchestration. Reference actual code behaviors and guarantee definitions from packages/core/src/ modules.",
            "status": "pending",
            "testStrategy": "Verify invariants match implementation behavior through code review and example validation.",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Write Known-Limits.md documenting implementation caps",
            "description": "Document limits and caps from core implementations: cache size limits, complexity thresholds, pattern witness generation caps, repair attempt limits, memory usage bounds.",
            "dependencies": [],
            "details": "Document specific limits enforced by implemented features: Task 14 cache limits, Task 8 composition complexity caps, Task 10 repair engine bounds, Task 9 generator limits. Include performance implications and degradation behaviors.",
            "status": "pending",
            "testStrategy": "Validate limits against actual implementation configurations and bench profile constraints.",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Write Features.md matrix reflecting actual implementation",
            "description": "Create comprehensive feature support matrix reflecting implementation status of Tasks 4-18: which JSON Schema features are implemented, their support level, and any known limitations.",
            "dependencies": [],
            "details": "Build feature matrix based on actual implementation coverage from core tasks. Include schema support levels, conditional handling, array/object support, numeric handling, and ref resolution capabilities implemented in the pipeline.",
            "status": "pending",
            "testStrategy": "Cross-reference feature claims with unit test coverage and integration test scenarios.",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Update error.md catalog with diagnostic codes",
            "description": "Document error catalog based on implemented diagnostic envelope from Task 6 and phase-specific error codes from Tasks 7-11.",
            "dependencies": [],
            "details": "Create comprehensive error documentation reflecting actual diagnostic codes, error propagation patterns, and recovery mechanisms implemented across the 5-stage pipeline. Reference Task 6 diagnostic envelope structure.",
            "status": "pending",
            "testStrategy": "Verify error codes match implementation and are properly categorized by pipeline phase.",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Update docs/README.md with implementation details",
            "description": "Update project README with accurate implementation details reflecting completed core tasks, actual performance characteristics, and usage examples based on implemented API.",
            "dependencies": [],
            "details": "Revise README to reflect actual implementation from Tasks 1-18: monorepo structure, pipeline architecture, performance characteristics from bench harness, API examples from Task 21 public API.",
            "status": "pending",
            "testStrategy": "Validate README accuracy against actual package structure and API signatures.",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "20",
        "title": "Fixtures & Bench profiles",
        "description": "Provide test fixtures and bench profiles (simple/medium/pathological); property-based generators for fuzzing.",
        "priority": "medium",
        "estimatedHours": 8,
        "dependencies": [
          "8000",
          "9000",
          "9115",
          "9120"
        ],
        "status": "pending",
        "complexityScore": 2,
        "details": "[Context] §15 bench protocol; §20 unit/property-based tests.\n- spec://§15#bench-protocol, spec://§20#unit\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§15\",\"anchors\":[\"spec://§15#bench-protocol\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Curate JSON Schemas and seeds; expose generators for fuzz tests; track metrics expectations.\n[Deliverables]\n- profiles/{simple,medium,pathological}.json\n- packages/core/test/fixtures/*\n[Commands]\n- pnpm -w test; pnpm -w bench\n[Definition of Done]\n- Bench runs on profiles; fixtures imported by tests.",
        "testStrategy": "Bench smoke and fixture validation with AJV.",
        "subtasks": [
          {
            "id": 20001,
            "title": "Create profiles and fixtures",
            "status": "pending",
            "estimatedHours": 8,
            "file": "profiles/simple.json",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "21",
        "title": "Public API & TS types",
        "description": "Exported functions and types for normalize/compose/generate/repair; stable signatures.",
        "priority": "medium",
        "estimatedHours": 12,
        "dependencies": [
          "8000",
          "9000",
          "9123",
          "9122"
        ],
        "status": "pending",
        "complexityScore": 3,
        "details": "[Context] §23 interfaces; §22 deliverables.\n- spec://§23#compose-interfaces, spec://§23#repair-interfaces\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§23\",\"anchors\":[\"spec://§23#compose-interfaces\",\"spec://§23#repair-interfaces\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- API mirrors minimal interfaces; do not expose internal caches.\n[Deliverables]\n- packages/core/src/index.ts (exports)\n- type declarations\n[Commands]\n- pnpm -w build\n[Definition of Done]\n- Type tests compile; API docs reflect interface anchors.",
        "testStrategy": "TS compile tests; simple programmatic examples.",
        "subtasks": [
          {
            "id": 21001,
            "title": "Export public API and types",
            "status": "pending",
            "estimatedHours": 12,
            "file": "packages/core/src/index.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "22",
        "title": "CI pipelines (lint, test, bench)",
        "description": "Set up CI with linting, unit/integration tests, and bench gates.",
        "status": "pending",
        "dependencies": [
          "8000",
          "9000",
          "9101",
          "9115",
          "9120",
          "17",
          "18"
        ],
        "priority": "high",
        "details": "[Context] §1 acceptance gates; §15 bench protocol.\n- spec://§1#bench-sli-gate, spec://§15#bench-protocol\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§1\",\"anchors\":[\"spec://§1#bench-sli-gate\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Jobs: lint → unit → integration → bench; fail on SLO breaches.\n- Requires completed unit test suite (task 17) and integration test suite (task 18) to execute\n- CI pipeline must validate test implementations before proceeding to bench gates\n[Deliverables]\n- .github/workflows/ci.yml\n[Commands]\n- n/a (CI runs)\n[Definition of Done]\n- CI green on baseline; bench gate enforced.\n- Unit and integration test suites execute successfully in CI pipeline",
        "testStrategy": "CI dry-run with reduced iterations; verify failure on forced breach. Test that CI correctly executes unit tests from task 17 and integration tests from task 18.",
        "subtasks": [
          {
            "id": 1,
            "title": "Create CI workflow with test dependencies",
            "description": "Set up GitHub Actions workflow that executes lint, unit tests, integration tests, and bench gates in sequence",
            "dependencies": [],
            "details": "Create .github/workflows/ci.yml that runs the test suites implemented in tasks 17 and 18. Pipeline must fail if unit or integration tests fail, before proceeding to bench gates. Include proper job dependencies and failure handling.",
            "status": "pending",
            "testStrategy": "Verify workflow triggers on PR/push, executes all test phases, and fails appropriately on test failures",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "23",
        "title": "P2 refinements",
        "description": "Deferred features: propertyNames pattern-form rewrite; pattern approximations for must-cover; contains subsumption.",
        "priority": "medium",
        "estimatedHours": 8,
        "dependencies": [
          "8000",
          "9000",
          "9116",
          "9108"
        ],
        "status": "pending",
        "complexityScore": 2,
        "details": "[Context] §16 Phase P2; §7 propertyNames pattern-form; §8 pattern approximations.\n- spec://§16#phase-p2, spec://§7#object-keywords-pnames-rewrite\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§16\",\"anchors\":[\"spec://§16#phase-p2\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Implement anchored-safe pattern-form rewrite with all guards; keep phase separation diagnostics.\n[Deliverables]\n- Extend schema-normalizer.ts and composition-engine.ts\n[Commands]\n- pnpm -w build; pnpm -w test\n[Definition of Done]\n- New rewrite gated by unevaluated*, complexity cap, and anchored-safe rules; tests added.",
        "testStrategy": "Unit: acceptance/refusal for pattern-form; integration: must-cover finite enumeration updated when PNAMES_REWRITE_APPLIED present.",
        "subtasks": [
          {
            "id": 23001,
            "title": "Enable pattern-form rewrite",
            "status": "pending",
            "estimatedHours": 8,
            "file": "packages/core/src/transform/schema-normalizer.ts",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "24",
        "title": "Packaging & Release",
        "description": "Prepare versioning, changelog, and publish configuration; SemVer alignment.",
        "priority": "medium",
        "estimatedHours": 8,
        "dependencies": [
          "8000",
          "9000",
          "9124",
          "9117"
        ],
        "status": "pending",
        "complexityScore": 2,
        "details": "[Context] §24 references (SemVer); §17 docs.\n- spec://§24#normative\n[Retrieval]\n- REFONLY::{\"source\":\"FILE\",\"uri\":\"docs/feature-simplification/feature-support-simplification.md\",\"section\":\"§24\",\"anchors\":[\"spec://§24#normative\"],\"notes\":\"no-embed; fetch-on-demand\"}\n[Key requirements]\n- Changelog and release scripts; version tags; license headers.\n[Deliverables]\n- package.json versioning scripts; docs/CHANGELOG.md\n[Commands]\n- pnpm version <x.y.z>\n[Definition of Done]\n- Release artifact builds; changelog updated; tagged commit.",
        "testStrategy": "Dry-run publish; verify files included.",
        "subtasks": [
          {
            "id": 24001,
            "title": "Prepare release artifacts and changelog",
            "status": "pending",
            "estimatedHours": 8,
            "file": "docs/CHANGELOG.md",
            "parentId": "undefined"
          }
        ]
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-10-22T22:34:17.928Z",
      "taskCount": 52,
      "completedCount": 44,
      "tags": [
        "feature-simplification"
      ]
    }
  }
}